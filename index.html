<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Rafaela Finance</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3a0ca3;
      --success: #4cc9f0;
      --danger: #f72585;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
    }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background:linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:20px; }
    .container { background:#fff; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,.15); width:100%; max-width:450px; overflow:hidden; margin-bottom:20px; }
    .header { background:linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color:#fff; padding:25px; text-align:center; }
    .header h1 { font-size:28px; margin-bottom:5px; font-weight:600; }
    .content { padding:25px; }
    .form-group { margin-bottom:20px; }
    .form-group label { display:block; margin-bottom:8px; color:var(--dark); font-weight:500; font-size:14px; }
    .form-group input { width:100%; padding:14px 15px; border:1px solid #ddd; border-radius:8px; font-size:16px; transition:all .3s; }
    .form-group input:focus { border-color:var(--primary); outline:none; box-shadow:0 0 0 3px rgba(67,97,238,.2); }
    .btn { display:block; width:100%; padding:14px; background:var(--primary); color:#fff; border:none; border-radius:8px; font-size:16px; font-weight:500; cursor:pointer; transition:all .3s; text-align:center; margin-bottom:15px; }
    .btn:hover { background:var(--secondary); transform:translateY(-2px); box-shadow:0 4px 10px rgba(0,0,0,.15); }
    .btn-google { background:#db4437; display:flex; align-items:center; justify-content:center; }
    .btn-google:hover { background:#c03a2e; }
    .btn i { margin-right:10px; }
    .divider { display:flex; align-items:center; margin:25px 0; color:var(--gray); }
    .divider::before, .divider::after { content:""; flex:1; height:1px; background:#ddd; }
    .divider span { padding:0 15px; font-size:14px; }
    .alert { padding:12px 15px; border-radius:8px; margin-bottom:20px; display:flex; align-items:center; }
    .alert-error { background:#ffebee; color:#c62828; border:1px solid #ef9a9a; }
    .alert-success { background:#e8f5e9; color:#2e7d32; border:1px solid #a5d6a7; }
    .user-type { display:flex; margin-bottom:20px; border-radius:8px; overflow:hidden; border:1px solid #ddd; }
    .user-type-btn { flex:1; padding:12px; text-align:center; background:#f8f9fa; cursor:pointer; transition:all .3s; font-weight:500; }
    .user-type-btn.active { background:var(--primary); color:#fff; }
    .dashboard { display:none; background:#fff; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,.15); width:100%; max-width:800px; overflow:hidden; margin-bottom:20px; }
    .dashboard-header { background:linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color:#fff; padding:20px; display:flex; justify-content:space-between; align-items:center; }
    .user-info { display:flex; align-items:center; }
    .user-avatar { width:40px; height:40px; border-radius:50%; background:rgba(255,255,255,.2); display:flex; align-items:center; justify-content:center; margin-right:10px; font-size:20px; }
    .logout-btn { background:rgba(255,255,255,.2); color:#fff; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; }
    .logout-btn:hover { background:rgba(255,255,255,.3); }
    .welcome-message { margin-bottom:20px; padding:15px; background:#f8f9fa; border-radius:8px; border-left:4px solid var(--primary); }
    .security-note { background:#fff3cd; border-left:4px solid #ffc107; color:#856404; padding:15px; margin:20px 0; border-radius:5px; }
    .loading { display:none; text-align:center; padding:15px; }
    .loading-spinner { border:3px solid #f3f3f3; border-top:3px solid var(--primary); border-radius:50%; width:30px; height:30px; animation:spin 1s linear infinite; margin:0 auto; }
    @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container" id="loginContainer">
    <div class="header">
      <h1>Rafaela Finance</h1>
      <p>Sistem Manajemen Keuangan</p>
    </div>
    <div class="content">
      <div class="alert alert-error" id="errorAlert" style="display:none;"><i class="fas fa-exclamation-circle"></i><span id="errorMessage"></span></div>
      <div class="alert alert-success" id="successAlert" style="display:none;"><i class="fas fa-check-circle"></i><span id="successMessage"></span></div>

      <div class="user-type">
        <div class="user-type-btn active" id="ownerBtn">Owner</div>
        <div class="user-type-btn" id="staffBtn">Staff</div>
      </div>

      <div id="ownerLogin">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" placeholder="Masukkan username">
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" placeholder="Masukkan password">
        </div>
        <button class="btn" id="loginOwnerBtn"><i class="fas fa-sign-in-alt"></i> Login sebagai Owner</button>
      </div>

      <div id="staffLogin" style="display:none;">
        <div class="divider"><span>Login dengan Google</span></div>
        <button class="btn btn-google" id="googleLoginBtn"><i class="fab fa-google"></i>Login dengan Google</button>
      </div>
    </div>
  </div>

  <div class="dashboard" id="dashboard">
    <div class="dashboard-header">
      <div class="user-info">
        <div class="user-avatar"><i class="fas fa-user"></i></div>
        <div>
          <div id="userName">Pengguna</div>
          <div id="userRole" style="font-size:12px; opacity:.8;">Role</div>
        </div>
      </div>
      <button class="logout-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>
    <div class="dashboard-content">
      <div class="welcome-message">
        <h3>Selamat datang, <span id="welcomeUserName">Pengguna</span>!</h3>
        <p>Anda login sebagai <span id="welcomeUserRole">role</span> pada sistem Rafaela Finance.</p>
      </div>
      <div class="security-note">
        <h4><i class="fas fa-shield-alt"></i> Penting: Keamanan Database</h4>
        <p>Aturan keamanan Firebase Anda saat ini bersifat publik. Untuk mengamankan data, silakan update aturan keamanan Firestore di Firebase Console.</p>
      </div>
      <div id="ownerDashboard" style="display:none;">
        <h3><i class="fas fa-users-cog"></i> Manajemen Staff</h3>
        <div class="staff-list" id="dashboardStaffList"><p style="text-align:center; color:var(--gray);">Memuat data staff...</p></div>
      </div>
      <div id="staffDashboard" style="display:none;">
        <h3><i class="fas fa-tasks"></i> Dashboard Staff</h3>
        <p>Ini adalah dashboard untuk staff.</p>
      </div>
    </div>
  </div>

  <div class="footer"><p>Â© <span id="currentYear">2025</span> Rafaela Print - Sistem Manajemen Keuangan</p></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC57gZNXlJoGvTKnTCgCfspMC_qPgkLvtU",
      authDomain: "rafaela-finance.firebaseapp.com",
      projectId: "rafaela-finance",
      storageBucket: "rafaela-finance.firebasestorage.app",
      messagingSenderId: "45081143872",
      appId: "1:45081143872:web:91d15b2732c24178ee0da5",
      measurementId: "G-XM0GEZY4PK"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginContainer = document.getElementById('loginContainer');
    const dashboard = document.getElementById('dashboard');
    const ownerBtn = document.getElementById('ownerBtn');
    const staffBtn = document.getElementById('staffBtn');
    const ownerLogin = document.getElementById('ownerLogin');
    const staffLogin = document.getElementById('staffLogin');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginOwnerBtn = document.getElementById('loginOwnerBtn');
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const errorAlert = document.getElementById('errorAlert');
    const errorMessage = document.getElementById('errorMessage');
    const successAlert = document.getElementById('successAlert');
    const successMessage = document.getElementById('successMessage');
    const userName = document.getElementById('userName');
    const userRole = document.getElementById('userRole');
    const welcomeUserName = document.getElementById('welcomeUserName');
    const welcomeUserRole = document.getElementById('welcomeUserRole');
    const logoutBtn = document.getElementById('logoutBtn');
    const ownerDashboard = document.getElementById('ownerDashboard');
    const staffDashboard = document.getElementById('staffDashboard');
    const dashboardStaffList = document.getElementById('dashboardStaffList');
    const currentYear = document.getElementById('currentYear');

    currentYear.textContent = new Date().getFullYear();

    let currentUser = null;

    ownerBtn.addEventListener('click', () => {
      ownerBtn.classList.add('active');
      staffBtn.classList.remove('active');
      ownerLogin.style.display = 'block';
      staffLogin.style.display = 'none';
    });

    staffBtn.addEventListener('click', () => {
      staffBtn.classList.add('active');
      ownerBtn.classList.remove('active');
      staffLogin.style.display = 'block';
      ownerLogin.style.display = 'none';
    });

    // ð Login Owner (connect ke Firebase)
    loginOwnerBtn.addEventListener('click', () => {
      const username = usernameInput.value;
      const password = passwordInput.value;
      if (username === 'Rafaela' && password === 'Daniarku19') {
        auth.signInAnonymously()
          .then(() => {
            currentUser = {
              name: 'Rafaela',
              role: 'owner',
              email: 'arinkumanja76@gmail.com',
              uid: "N755UkVPGUXaDdYNCQ10rSBUbYi2" // atau ganti ke GAfTnHx... jika ingin
            };
            showSuccess('Login Owner berhasil!');
            showDashboard();
          })
          .catch(err => showError("Error login owner: " + err.message));
      } else {
        showError('Username atau password salah!');
      }
    });

    // ð Login Staff
    googleLoginBtn.addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then((result) => {
          const user = result.user;
          currentUser = {
            name: user.displayName,
            role: 'staff',
            email: user.email,
            uid: user.uid
          };
          showSuccess(`Login berhasil sebagai ${user.displayName}`);
          showDashboard();
        })
        .catch(err => showError("Error: " + err.message));
    });

    function showDashboard() {
      loginContainer.style.display = 'none';
      dashboard.style.display = 'block';
      userName.textContent = currentUser.name;
      userRole.textContent = currentUser.role === 'owner' ? 'Pemilik Sistem' : 'Staf';
      welcomeUserName.textContent = currentUser.name;
      welcomeUserRole.textContent = currentUser.role === 'owner' ? 'Pemilik' : 'Staf';
      if (currentUser.role === 'owner') {
        ownerDashboard.style.display = 'block';
        staffDashboard.style.display = 'none';
      } else {
        ownerDashboard.style.display = 'none';
        staffDashboard.style.display = 'block';
      }
    }

    logoutBtn.addEventListener('click', () => {
      auth.signOut().then(() => {
        dashboard.style.display = 'none';
        loginContainer.style.display = 'block';
        currentUser = null;
      });
    });

    function showError(msg){ errorMessage.textContent=msg; errorAlert.style.display='flex'; }
    function showSuccess(msg){ successMessage.textContent=msg; successAlert.style.display='flex'; setTimeout(()=>successAlert.style.display='none',3000);}
  </script>
</body>
</html>
